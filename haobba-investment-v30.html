<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•˜ì˜¤ë¹  íˆ¬ìí´ëŸ½ V3.2 - ë¬´ë£Œ ì‹¤ì‹œê°„</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: rgba(52, 152, 219, 0.3);
            touch-action: manipulation;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #F5F7FA;
            color: #1A2332;
            font-size: 15px;
            line-height: 1.5;
            overscroll-behavior: none;
        }

        .container {
            max-width: 100%;
            min-height: 100vh;
            background: #F5F7FA;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #2C3E50 0%, #3498DB 100%);
            color: white;
            padding: 20px 16px 16px 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: relative;
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 6px;
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.95;
        }

        .header .version {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 4px;
        }

        .header .data-status {
            font-size: 10px;
            opacity: 0.8;
            margin-top: 6px;
        }

        .status-live { background: #2ECC71; }
        .status-static { background: #F39C12; }

        .refresh-btn {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            user-select: none;
        }

        /* ê³µí¬íƒìš• */
        .fear-greed-fixed {
            position: sticky;
            top: 0;
            z-index: 100;
            background: white;
            padding: 12px 16px;
            border-bottom: 2px solid #E8EBF3;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .fear-greed-title {
            font-size: 13px;
            font-weight: 700;
            color: #4A5B75;
            margin-bottom: 8px;
            text-align: center;
        }

        .fear-greed-bar {
            position: relative;
            height: 50px;
            background: linear-gradient(to right, #E74C3C 0%, #F39C12 25%, #27AE60 50%, #F39C12 75%, #E74C3C 100%);
            border-radius: 10px;
            border: 2px solid #BDC3C7;
            margin-bottom: 8px;
        }

        .fear-greed-pointer {
            position: absolute;
            width: 3px;
            height: 100%;
            background: #1A2332;
            border-radius: 2px;
            transition: left 0.5s ease;
        }

        .fear-greed-value {
            position: absolute;
            width: 100%;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .fear-greed-action {
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            padding: 8px;
            border-radius: 6px;
        }

        .action-buy { background: #D4EDDA; color: #155724; }
        .action-hold { background: #FFF3CD; color: #856404; }
        .action-sell { background: #F8D7DA; color: #721C24; }

        /* íƒ­ */
        .tabs-container {
            background: white;
            border-bottom: 2px solid #E8EBF3;
            overflow-x: auto;
            position: sticky;
            top: 97px;
            z-index: 99;
        }

        .tabs-scroll {
            display: flex;
            padding: 8px;
            gap: 6px;
        }

        .tab {
            flex: 0 0 auto;
            padding: 10px 14px;
            background: #F8F9FC;
            border: 2px solid #E8EBF3;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #4A5B75;
            min-height: 44px;
            user-select: none;
        }

        .tab.active {
            background: linear-gradient(135deg, #3498DB 0%, #5DADE2 100%);
            color: white;
            border-color: #2980B9;
        }

        /* ì„¹ì…˜ */
        .section {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 17px;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E8EBF3;
        }

        /* ì»¨í…ì¸  */
        .content-area {
            padding: 12px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ë²„íŠ¼ */
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #3498DB 0%, #5DADE2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            min-height: 48px;
            user-select: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        /* ì¸í¬ë°•ìŠ¤ */
        .info-box {
            background: #FFF9E6;
            border: 2px solid #F39C12;
            border-left: 5px solid #F39C12;
            border-radius: 8px;
            padding: 14px;
            margin: 12px 0;
        }

        .info-title {
            font-size: 14px;
            font-weight: 700;
            color: #E67E22;
            margin-bottom: 8px;
        }

        .info-content {
            font-size: 13px;
            line-height: 1.6;
            color: #7F8C8D;
        }

        .success-box {
            background: #D4EDDA;
            border-color: #28A745;
        }

        .success-box .info-title {
            color: #155724;
        }

        .warning-box {
            background: #FFE8E8;
            border-color: #E74C3C;
        }

        .warning-box .info-title {
            color: #C0392B;
        }

        /* API ìƒíƒœ */
        .api-status {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border: 2px solid #E8EBF3;
        }

        .api-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #F8F9FC;
        }

        .api-item:last-child {
            border-bottom: none;
        }

        .api-label {
            font-size: 13px;
            font-weight: 600;
            color: #2C3E50;
        }

        .api-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .badge-connected {
            background: #D4EDDA;
            color: #155724;
        }

        .badge-pending {
            background: #FFF3CD;
            color: #856404;
        }

        .badge-error {
            background: #F8D7DA;
            color: #721C24;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <button class="refresh-btn" onclick="refreshAllData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <h1>ğŸ’¼ í•˜ì˜¤ë¹  íˆ¬ìí´ëŸ½</h1>
            <p class="subtitle">ì†ì£¼ë¶€ íˆ¬ìë²• + ë¬´ë£Œ ì‹¤ì‹œê°„ ë°ì´í„°</p>
            <p class="version">V3.2 - Free Real-time Edition</p>
            <p class="data-status" id="dataStatus">
                API ì—°ê²° í™•ì¸ ì¤‘...
            </p>
        </div>

        <!-- ê³µí¬íƒìš• ì§€ìˆ˜ -->
        <div class="fear-greed-fixed">
            <div class="fear-greed-title" id="fgTitle">
                ğŸ˜± ê³µí¬ì™€ íƒìš• ì§€ìˆ˜
            </div>
            <div class="fear-greed-bar">
                <div id="fearGreedPointer" class="fear-greed-pointer" style="left: 50%;"></div>
                <div class="fear-greed-value" id="fearGreedValue">--</div>
            </div>
            <div id="fearGreedAction" class="fear-greed-action action-hold">
                ë°ì´í„° ë¡œë”© ì¤‘...
            </div>
        </div>

        <!-- íƒ­ -->
        <div class="tabs-container">
            <div class="tabs-scroll">
                <div class="tab active" onclick="switchTab(event, 'setup')">âš™ï¸ ì„¤ì •</div>
                <div class="tab" onclick="switchTab(event, 'main')">ğŸ† íˆ¬ìë²•</div>
                <div class="tab" onclick="switchTab(event, 'screener')">ğŸ¯ ìŠ¤í¬ë¦¬ë„ˆ</div>
            </div>
        </div>

        <!-- ì»¨í…ì¸  -->
        <div class="content-area">
            
            <!-- âš™ï¸ ì„¤ì • -->
            <div id="tab-setup" class="tab-content active">
                <div class="section">
                    <div class="section-title">âš™ï¸ API ì„¤ì •</div>
                    
                    <div class="warning-box">
                        <div class="info-title">ğŸš¨ ì¤‘ìš”: API URL ì…ë ¥ í•„ìˆ˜!</div>
                        <div class="info-content">
                            ë¬´ë£Œ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € ë°±ì—”ë“œ ì„œë²„ë¥¼ ë°°í¬í•˜ê³ <br>
                            ì•„ë˜ì— URLì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div style="margin-bottom: 12px;">
                        <label style="font-size: 14px; font-weight: 600; color: #4A5B75; display: block; margin-bottom: 6px;">
                            ğŸŒ Vercel API URL
                        </label>
                        <input type="text" id="apiUrlInput" 
                               style="width: 100%; padding: 12px; border: 2px solid #E8EBF3; border-radius: 8px; font-size: 14px;"
                               placeholder="https://haobba-api-xxx.vercel.app"
                               value="">
                        <p style="font-size: 11px; color: #7F8C8D; margin-top: 4px;">
                            ì˜ˆì‹œ: https://haobba-api-abc123.vercel.app
                        </p>
                    </div>

                    <button class="btn" onclick="saveApiUrl()">
                        ğŸ’¾ ì €ì¥ ë° ì—°ê²° í…ŒìŠ¤íŠ¸
                    </button>
                </div>

                <div class="section">
                    <div class="section-title">ğŸ“Š API ì—°ê²° ìƒíƒœ</div>
                    
                    <div class="api-status">
                        <div class="api-item">
                            <span class="api-label">ê³µí¬íƒìš• ì§€ìˆ˜</span>
                            <span id="fgApiStatus" class="api-badge badge-pending">ëŒ€ê¸°ì¤‘</span>
                        </div>
                        <div class="api-item">
                            <span class="api-label">ì¢…ëª© ë°ì´í„° (NVDA)</span>
                            <span id="stockApiStatus" class="api-badge badge-pending">ëŒ€ê¸°ì¤‘</span>
                        </div>
                        <div class="api-item">
                            <span class="api-label">ì˜¤ëŠ˜ API ì‚¬ìš©</span>
                            <span id="apiUsage" class="api-badge badge-pending">0/500</span>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-title">ğŸ“š ë°±ì—”ë“œ ì„œë²„ ë§Œë“¤ê¸° (10ë¶„)</div>
                    <div class="info-content">
                        <strong>Step 1:</strong> GitHubì— haobba-api ì €ì¥ì†Œ ìƒì„±<br>
                        <strong>Step 2:</strong> 5ê°œ íŒŒì¼ ì—…ë¡œë“œ (ì½”ë“œ ì œê³µë¨)<br>
                        <strong>Step 3:</strong> Vercelì—ì„œ ë°°í¬ (ë¬´ë£Œ)<br>
                        <strong>Step 4:</strong> URLì„ ìœ„ì— ì…ë ¥<br>
                        <br>
                        <strong style="color: #27AE60;">âœ… ì™„ì „ ë¬´ë£Œ (500íšŒ/ì¼)</strong>
                    </div>
                </div>
            </div>

            <!-- ğŸ† íˆ¬ìë²• -->
            <div id="tab-main" class="tab-content">
                <div class="section">
                    <div class="section-title">ğŸ† ì†ì£¼ë¶€ íˆ¬ìë²•</div>
                    
                    <div class="success-box">
                        <div class="info-title">âœ… ì´ì œ ì‹¤ì‹œê°„ ë°ì´í„° ì§€ì›!</div>
                        <div class="info-content">
                            â€¢ ê³µí¬íƒìš• ì§€ìˆ˜: ì‹¤ì‹œê°„ (10ë¶„ë§ˆë‹¤ ìë™)<br>
                            â€¢ ì£¼ìš” ì¢…ëª© PEG/ROE: ì‹¤ì‹œê°„ (í•˜ë£¨ 2íšŒ)<br>
                            â€¢ ì™„ì „ ë¬´ë£Œ (Alpha Vantage 500íšŒ/ì¼)
                        </div>
                    </div>

                    <div class="info-box">
                        <div class="info-title">ğŸ¯ íˆ¬ì 3ì›ì¹™</div>
                        <div class="info-content">
                            <strong>1. ì‹¼ ê²ƒì„ ì‚¬ë¼</strong> - PEG < 1.0<br>
                            <strong>2. ì¢‹ì€ ê¸°ì—… ë³´ìœ </strong> - ROE > 15%<br>
                            <strong>3. ê³µí¬í•  ë•Œ ë§¤ìˆ˜</strong> - ì§€ìˆ˜ 25 ì´í•˜
                        </div>
                    </div>
                </div>
            </div>

            <!-- ğŸ¯ ìŠ¤í¬ë¦¬ë„ˆ -->
            <div id="tab-screener" class="tab-content">
                <div class="section">
                    <div class="section-title">ğŸ¯ ì‹¤ì‹œê°„ ìŠ¤í¬ë¦¬ë„ˆ</div>
                    
                    <div class="info-box">
                        <div class="info-title">ğŸ”„ ë°ì´í„° ê°±ì‹  ì „ëµ</div>
                        <div class="info-content">
                            <strong>ì£¼ìš” 20ê°œ ì¢…ëª©</strong> - í•˜ë£¨ 2íšŒ ìë™ ê°±ì‹ <br>
                            <strong>ë‚˜ë¨¸ì§€ 180ê°œ</strong> - ì •ì  ë°ì´í„° (2025.01.15)<br>
                            <strong>ë¬´ë£Œ ì œí•œ</strong> - 500íšŒ/ì¼ (ì¶©ë¶„í•¨!)
                        </div>
                    </div>

                    <button class="btn" onclick="updateTopStocks()">
                        ğŸ“Š ì£¼ìš” ì¢…ëª© ì§€ê¸ˆ ê°±ì‹ í•˜ê¸°
                    </button>

                    <div id="stockResults" style="margin-top: 12px;">
                        <!-- ê²°ê³¼ í‘œì‹œ -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // === ê¸€ë¡œë²Œ ì„¤ì • ===
        let API_URL = localStorage.getItem('apiUrl') || '';
        let apiCallCount = parseInt(localStorage.getItem('apiCallCount') || '0');
        let lastResetDate = localStorage.getItem('lastResetDate') || new Date().toDateString();

        // ë‚ ì§œê°€ ë°”ë€Œë©´ ì¹´ìš´íŠ¸ ë¦¬ì…‹
        if (lastResetDate !== new Date().toDateString()) {
            apiCallCount = 0;
            localStorage.setItem('apiCallCount', '0');
            localStorage.setItem('lastResetDate', new Date().toDateString());
        }

        // ì£¼ìš” ì¢…ëª© 20ê°œ (ì‹¤ì‹œê°„ ê°±ì‹ )
        const TOP_STOCKS = [
            'NVDA', 'META', 'GOOGL', 'MSFT', 'AAPL',
            'AMZN', 'TSLA', 'AMD', 'TSM', 'AVGO',
            'CRM', 'ORCL', 'JPM', 'V', 'MA',
            'WMT', 'COST', 'JNJ', 'UNH', 'PFE'
        ];

        // === API URL ì €ì¥ ===
        function saveApiUrl() {
            const url = document.getElementById('apiUrlInput').value.trim();
            
            if (!url) {
                alert('âŒ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            if (!url.startsWith('http')) {
                alert('âŒ https://ë¡œ ì‹œì‘í•˜ëŠ” URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            API_URL = url.replace(/\/$/, ''); // ëì˜ / ì œê±°
            localStorage.setItem('apiUrl', API_URL);
            
            alert('âœ… API URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì—°ê²° í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...');
            
            testApiConnection();
        }

        // === API ì—°ê²° í…ŒìŠ¤íŠ¸ ===
        async function testApiConnection() {
            // ê³µí¬íƒìš• í…ŒìŠ¤íŠ¸
            try {
                document.getElementById('fgApiStatus').textContent = 'í…ŒìŠ¤íŠ¸ì¤‘...';
                document.getElementById('fgApiStatus').className = 'api-badge badge-pending';
                
                const response = await fetch(`${API_URL}/api/feargreed`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('fgApiStatus').textContent = 'âœ… ì—°ê²°ë¨';
                    document.getElementById('fgApiStatus').className = 'api-badge badge-connected';
                    
                    // ê³µí¬íƒìš• ì§€ìˆ˜ ì—…ë°ì´íŠ¸
                    updateFearGreed(parseInt(data.data.value));
                    
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                document.getElementById('fgApiStatus').textContent = 'âŒ ì‹¤íŒ¨';
                document.getElementById('fgApiStatus').className = 'api-badge badge-error';
                console.error('ê³µí¬íƒìš• API ì˜¤ë¥˜:', error);
            }

            // ì¢…ëª© ë°ì´í„° í…ŒìŠ¤íŠ¸
            try {
                document.getElementById('stockApiStatus').textContent = 'í…ŒìŠ¤íŠ¸ì¤‘...';
                
                const response = await fetch(`${API_URL}/api/stock?ticker=NVDA`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('stockApiStatus').textContent = 'âœ… ì—°ê²°ë¨';
                    document.getElementById('stockApiStatus').className = 'api-badge badge-connected';
                    
                    incrementApiCall();
                    
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                document.getElementById('stockApiStatus').textContent = 'âŒ ì‹¤íŒ¨';
                document.getElementById('stockApiStatus').className = 'api-badge badge-error';
                console.error('ì¢…ëª© ë°ì´í„° API ì˜¤ë¥˜:', error);
            }

            updateDataStatus();
        }

        // === API í˜¸ì¶œ ì¹´ìš´íŠ¸ ===
        function incrementApiCall() {
            apiCallCount++;
            localStorage.setItem('apiCallCount', apiCallCount.toString());
            document.getElementById('apiUsage').textContent = `${apiCallCount}/500`;
            
            if (apiCallCount >= 500) {
                document.getElementById('apiUsage').className = 'api-badge badge-error';
                alert('âš ï¸ ì˜¤ëŠ˜ì˜ API í• ë‹¹ëŸ‰ì„ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤!\në‚´ì¼ ë‹¤ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            } else if (apiCallCount >= 400) {
                document.getElementById('apiUsage').className = 'api-badge badge-pending';
            } else {
                document.getElementById('apiUsage').className = 'api-badge badge-connected';
            }
        }

        // === ê³µí¬íƒìš• ì§€ìˆ˜ ===
        async function fetchFearGreedIndex() {
            if (!API_URL) {
                console.log('âš ï¸ API URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/feargreed`);
                const result = await response.json();
                
                if (result.success) {
                    const value = parseInt(result.data.value);
                    updateFearGreed(value);
                    
                    document.getElementById('fgTitle').innerHTML = `
                        ğŸ˜± ê³µí¬ì™€ íƒìš• ì§€ìˆ˜ <span style="color: #2ECC71; font-size: 11px;">â— ì‹¤ì‹œê°„</span>
                    `;
                    
                    console.log('âœ… ê³µí¬íƒìš• ì§€ìˆ˜ ê°±ì‹ :', value);
                }
            } catch (error) {
                console.error('âŒ ê³µí¬íƒìš• API ì˜¤ë¥˜:', error);
            }
        }

        function updateFearGreed(value) {
            document.getElementById('fearGreedValue').textContent = value;
            document.getElementById('fearGreedPointer').style.left = value + '%';
            
            const actionBox = document.getElementById('fearGreedAction');
            if (value <= 25) {
                actionBox.className = 'fear-greed-action action-buy';
                actionBox.textContent = 'ğŸŸ¢ ê°•ë ¥ ë§¤ìˆ˜! (ê·¹ê³µí¬ - 70-80% ë¹„ì¤‘)';
            } else if (value <= 45) {
                actionBox.className = 'fear-greed-action action-buy';
                actionBox.textContent = 'ğŸŸ¢ ë§¤ìˆ˜ íƒ€ì´ë°! (ê³µí¬ - 50-70% ë¹„ì¤‘)';
            } else if (value <= 55) {
                actionBox.className = 'fear-greed-action action-hold';
                actionBox.textContent = 'ğŸŸ¡ ì¤‘ë¦½ (ê´€ë§ - 30-50% ë¹„ì¤‘)';
            } else if (value <= 75) {
                actionBox.className = 'fear-greed-action action-hold';
                actionBox.textContent = 'ğŸŸ¡ ì£¼ì˜ (íƒìš• - 20-30% ë¹„ì¤‘)';
            } else {
                actionBox.className = 'fear-greed-action action-sell';
                actionBox.textContent = 'ğŸ”´ ë§¤ë„! (ê·¹íƒìš• - ì°¨ìµì‹¤í˜„)';
            }
        }

        // === ì£¼ìš” ì¢…ëª© ê°±ì‹  ===
        async function updateTopStocks() {
            if (!API_URL) {
                alert('âš ï¸ ë¨¼ì € ì„¤ì • íƒ­ì—ì„œ API URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                switchTab(null, 'setup');
                return;
            }

            if (apiCallCount >= 500) {
                alert('âŒ ì˜¤ëŠ˜ì˜ API í• ë‹¹ëŸ‰ì„ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤!');
                return;
            }

            const resultsDiv = document.getElementById('stockResults');
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #7F8C8D;">ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';

            let results = [];
            let successCount = 0;

            for (let i = 0; i < Math.min(TOP_STOCKS.length, 500 - apiCallCount); i++) {
                const ticker = TOP_STOCKS[i];
                
                try {
                    const response = await fetch(`${API_URL}/api/stock?ticker=${ticker}`);
                    const data = await response.json();
                    
                    if (data.success && data.data.peg) {
                        results.push(data.data);
                        successCount++;
                        incrementApiCall();
                        
                        // ì§„í–‰ ìƒí™© í‘œì‹œ
                        resultsDiv.innerHTML = `<div style="text-align: center; padding: 20px; color: #7F8C8D;">
                            ${successCount}/${TOP_STOCKS.length} ì™„ë£Œ...
                        </div>`;
                        
                        // ê³¼ë„í•œ API í˜¸ì¶œ ë°©ì§€
                        await new Promise(resolve => setTimeout(resolve, 1000)); // 1ì´ˆ ëŒ€ê¸°
                    }
                } catch (error) {
                    console.error(`${ticker} ì˜¤ë¥˜:`, error);
                }
            }

            // ê²°ê³¼ í‘œì‹œ
            results.sort((a, b) => parseFloat(a.peg) - parseFloat(b.peg));
            
            resultsDiv.innerHTML = `
                <div class="success-box">
                    <div class="info-title">âœ… ${successCount}ê°œ ì¢…ëª© ê°±ì‹  ì™„ë£Œ!</div>
                    <div class="info-content">
                        API ì‚¬ìš©: ${apiCallCount}/500
                    </div>
                </div>
                <div style="margin-top: 12px;">
                    <strong>PEG ìˆœìœ„ TOP 10:</strong>
                    ${results.slice(0, 10).map((stock, idx) => `
                        <div style="padding: 8px; background: white; border: 1px solid #E8EBF3; border-radius: 6px; margin-top: 6px;">
                            <strong>${idx + 1}. ${stock.ticker}</strong> - ${stock.name}<br>
                            <span style="font-size: 13px; color: #7F8C8D;">
                                PEG: <strong style="color: #27AE60;">${stock.peg}</strong> | 
                                ROE: ${stock.roe?.toFixed(1)}% | 
                                PER: ${stock.per?.toFixed(1)}
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // === ìƒˆë¡œê³ ì¹¨ ===
        function refreshAllData() {
            if (!API_URL) {
                alert('âš ï¸ ë¨¼ì € API URLì„ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                switchTab(null, 'setup');
                return;
            }

            fetchFearGreedIndex();
            alert('âœ… ê³µí¬íƒìš• ì§€ìˆ˜ ê°±ì‹  ì™„ë£Œ!');
        }

        // === íƒ­ ì „í™˜ ===
        function switchTab(e, tabName) {
            if (e) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
            }
            
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // === ìƒíƒœ ì—…ë°ì´íŠ¸ ===
        function updateDataStatus() {
            const status = document.getElementById('dataStatus');
            if (API_URL) {
                status.innerHTML = `âœ… API ì—°ê²°ë¨ | ì‚¬ìš©: ${apiCallCount}/500`;
            } else {
                status.innerHTML = `âš ï¸ API URL ì„¤ì • í•„ìš” (ì„¤ì • íƒ­)`;
            }
        }

        // === ì´ˆê¸°í™” ===
        document.addEventListener('DOMContentLoaded', () => {
            // API URL ë³µì›
            if (API_URL) {
                document.getElementById('apiUrlInput').value = API_URL;
                testApiConnection();
                
                // 10ë¶„ë§ˆë‹¤ ê³µí¬íƒìš• ìë™ ê°±ì‹ 
                setInterval(fetchFearGreedIndex, 10 * 60 * 1000);
            }

            updateDataStatus();
            document.getElementById('apiUsage').textContent = `${apiCallCount}/500`;

            console.log('ğŸš€ í•˜ì˜¤ë¹  íˆ¬ìí´ëŸ½ V3.2 ì‹œì‘');
            console.log('ğŸ“Š API URL:', API_URL || 'ë¯¸ì„¤ì •');
            console.log('ğŸ“ˆ ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰:', apiCallCount, '/500');
        });
    </script>
</body>
</html>